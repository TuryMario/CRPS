<!doctype html>
<html lang="en">
<head>
	<meta charset="utf-8" />
	<link rel="icon" type="image/png" href="assets/img/favicon.ico">
	<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />

	<title>CRPS</title>

	<meta content='width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0' name='viewport' />
    <meta name="viewport" content="width=device-width" />


    <!-- Bootstrap core CSS     -->
    <link href="assets/css/bootstrap.min.css" rel="stylesheet" />

    <!-- Animation library for notifications   -->
    <link href="assets/css/animate.min.css" rel="stylesheet"/>

    <!--  Light Bootstrap Table core CSS    -->
    <link href="assets/css/light-bootstrap-dashboard.css" rel="stylesheet"/>


    <!--  CSS for Demo Purpose, don't include it in your project     -->
    <link href="assets/css/demo.css" rel="stylesheet" />


    <!--     Fonts and icons     -->
    <link href="http://maxcdn.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css" rel="stylesheet">
    <link href='http://fonts.googleapis.com/css?family=Roboto:400,700,300' rel='stylesheet' type='text/css'>
    <link href="assets/css/pe-icon-7-stroke.css" rel="stylesheet" />

    <script src="https://www.gstatic.com/firebasejs/4.0.0/firebase.js"></script>
    <script>
        // Initialize Firebase
        var config = {
        apiKey: "AIzaSyD2h8QFRDz6T5sWaiDJ9Ps7u8t42P3ad3A",
        authDomain: "grouptech-aa1c5.firebaseapp.com",
        databaseURL: "https://grouptech-aa1c5.firebaseio.com",
        projectId: "grouptech-aa1c5",
        storageBucket: "grouptech-aa1c5.appspot.com",
        messagingSenderId: "179428186159"
        };
        firebase.initializeApp(config);

        var user = firebase.auth().currentUser;
        var email;

        //Firebase real time listener
        firebase.auth().onAuthStateChanged(function(user) {
            if (user.email == 'mariotury@outlook.com') {
              console.log(user.email);
              document.getElementById("account").innerHTML = user.email;
              document.getElementById("email").value = user.email;
              //document.getElementById("demo").innerHTML = "Paragraph changed!"; 
        }else{
            console.log("Wrong user logged in....");
            window.location.replace("http://localhost/CRPS/account/index.html");
        }
          });

        function logout(){
            firebase.auth().signOut();
            window.location.replace("http://localhost/CRPS/account/index.html");
        }

    </script>

    <!-- Train and store neural nets dependencies -->
    <script src="https://code.jquery.com/jquery-3.2.1.js"
            integrity="sha256-DZAnKJ/6XZ9si04Hgrsxu/8s717jcIzLy3oi35EouyE="
            crossorigin="anonymous">
    </script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/synaptic/1.0.12/synaptic.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xls/0.7.4-a/xls.js"> </script>

    <!-- <script type="text/javascript" src="assets/js/crps.js"></script> -->
    <script src="assets/js/synaptic.js"></script>
    <script type="text/javascript" src="assets/js/jquery.min.js"></script>

    <style>
        /* The Modal (background) */
        .modal {
            display: none; /* Hidden by default */
            position: fixed; /* Stay in place */
            z-index: 1; /* Sit on top */
            padding-top: 100px; /* Location of the box */
            left: 0;
            top: 0;
            width: 100%; /* Full width */
            height: 100%; /* Full height */
            overflow: auto; /* Enable scroll if needed */
            background-color: rgb(0,0,0); /* Fallback color */
            background-color: rgba(0,0,0,0.4); /* Black w/ opacity */
        }

        /* Modal Content */
        .modal-content {
            background-color: #fefefe;
            margin: auto;
            padding: 20px;
            border: 1px solid #888;
            width: 50%;
            height: 50%;
        }

        /* Modal Header */
        .modal-header {
            padding: 2px 16px;
            background-color: #5cb85c;
            color: white;
        }

        /* Modal Body */
        .modal-body {padding: 2px 16px;}


        /* The Close Button */
        .close {
            color: #aaaaaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
        }

        .close:hover,
        .close:focus {
            color: #000;
            text-decoration: none;
            cursor: pointer;
        }
    </style>

    <style type="text/css">

    .btn, .upload {
        min-width: 100%;
        height: 40px;
        margin: 0;
        padding: 0 20px;
        vertical-align: middle;
        border: 0;
        font-family: 'Roboto', sans-serif;
        font-size: 16px;
        font-weight: 300;
        line-height: 40px;
        color: #000;
        -moz-border-radius: 4px; -webkit-border-radius: 4px; border-radius: 4px;
        text-shadow: none;
        -moz-box-shadow: none; -webkit-box-shadow: none; box-shadow: none;
        -o-transition: all .3s; -moz-transition: all .3s; -webkit-transition: all .3s; -ms-transition: all .3s; transition: all .3s;
    }

    .change_button{
            width: 100%;
    }
    </style>

</head>
<body>

<div class="wrapper">
    <div class="sidebar" data-color="blue" data-image="assets/img/sidebar-5.jpg">

    <!--

        Tip 1: you can change the color of the sidebar using: data-color="blue | azure | green | orange | red | purple"
        Tip 2: you can also add an image using data-image tag

    -->

    	<div class="sidebar-wrapper">
            <div class="logo">
                <a href="#" class="simple-text">
                    CRPS
                </a>
            </div>

            <ul class="nav">
                <li class="active">
                    <a href="dashboard.html">
                        <i class="pe-7s-graph"></i>
                        <p>Dashboard</p>
                    </a>
                </li>    
            </ul>
    	</div>
    </div>

    <div class="main-panel">
        <nav class="navbar navbar-default navbar-fixed">
            <div class="container-fluid">
                <div class="navbar-header">
                    <!-- <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navigation-example-2">
                        <span class="sr-only">Toggle navigation</span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                    </button> -->
                    <a class="navbar-brand" href="#">Admin Dashboard</a>
                </div>
                <div class="collapse navbar-collapse"> 
                    <ul class="nav navbar-nav navbar-right">
                        <li class="dropdown">
                              <a href="#" id="account" class="dropdown-toggle" data-toggle="dropdown">
                                    Account
                                    <b class="caret"></b>
                              </a>
                              <ul class="dropdown-menu">
                                <li><button class="btn" style="background-color: #abc" id="btnLogout" onclick="logout()">Logout Account</button></li>
                              </ul>
                        </li>
                    </ul>
                </div>
            </div>
        </nav>


        <div class="content">
            <div class="container-fluid">
                <div class="row">
                    <div class="col-md-12">
                        <div class="card">
                            <div class="header">
                                <h4 class="title">Algorithm</h4>
                                <p class="category">Performance</p>
                            </div>
                            <!-- Line graph readings -->
                            <div class="content">
                                <canvas id="linegraph"></canvas>
                            </div> 
                            
                        </div>
                    </div>
                </div>

                <div class="row">
                    <div class="col-md-6">
                        <div class="card ">
                            <div class="header">
                                <h4 class="title">Neural Network Variables</h4>
                                <p class="category">Train</p>
                            </div>
                            <!-- Change training variables -->
                            <input type="number" id="sl" name="sl" placeholder="Second Level">
                            <input type="number" id="tl" name="tl" placeholder="Third Level">
                            <input type="number" id="fl" name="fl" placeholder="Fourth Level">
                            <select id="networkxact" name="networkxact" class="options">
                                <option>--- Activation Function---</option>
                                <option>synaptic.Neuron.LOGISTIC</option>
                                <option>synaptic.Neuron.TANH</option>
                                <option>synaptic.Neuron.IDENTITY</option>
                                <option>synaptic.Neuron.HLIM</option>
                                <option>synaptic.Neuron.ReLUM</option>
                            </select><br>
                            <input type="number" id="iterations" name="iterations" placeholder="Iterations">
                            <input type="number" id="rate" name="rate" placeholder="Training Rate">
                            <input type="number" id="errorz" name="errorz" placeholder="Error">
                            <select id="networktype" name="networktype" class="options">
                                <option>--- Network Type ---</option>
                                <option>Perceptron</option>
                                <option>LSTM</option>
                            </select><br><br>
                            <button id="tnnx" class="btn" style="background-color: #396c9e; color: #fff">Train Nueral Net with New modifications</button>
                        </div>
                    </div>

                    <div class="col-md-6">
                        <div class="card ">
                            <div class="header">
                                <h4 class="title">Neural Network Testing</h4>
                                <p class="category">Test</p>
                            </div>
                                <!-- Testing Network -->
                                <br>
                                <input type="file" id="csvFileInput" onchange="handleFiles(this.files)" accept=".csv"><br><br>

                                <input class="btn" id="tnn" style="background-color: #ff5500; color: #fff" type="button" value="Train Nueral Net"><br><br>

                                <input class="btn" id="unnws" style="background-color: #ff5500; color: #fff" type="button" value="Use Nueral Net Without Storing"><br><br>

                                <p id="answer2" style="color: red;"></p><br>

                                <input class="btn" id="snn" style="background-color: #2a5fad;color: #fff" type="button" value="Store Nueral Net"><br><br>

                                <input class="btn" id="unns" style="background-color: #2a5fad;color: #fff" type="button" value="Use Nueral Net Stored">

                                <p id="answer" style="color: blue;"></p><br>
                        </div>
                    </div>
                </div>

                <div class="row">
                    <div class="col-md-5">
                        <div class="card ">
                            <div class="header">
                                <h4 class="title">Customer Summary</h4>
                                <p class="category">Credibility</p>
                            </div>
                                <!-- piechart data -->
                            <div class="content">
                                <canvas id="pie-chartcanvas-1"></canvas>
                            </div>
                        </div>
                    </div>

                    <div class="col-md-7">
                        <div class="row">
                            <div class="col-md-6"">
                                <div class="card ">
                                    <div class="header">
                                        <h4 class="title">Customers</h4>
                                        <p class="category">Current Number</p>
                                    </div>
                                    <!-- piechart data -->
                                    <div class="content">
                                        <b>
                                            <h1 id="clients" style="text-align: center; font-size: 400%;">
                                            </h1>
                                        </b>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-12">
                                <div class="card ">
                                    <div class="header">
                                        <h4 class="title">Search</h4>
                                        <p class="category">Check Credibility</p>
                                    </div>
                                    <!-- table Search content -->
                                    <div class="content">

                                        <div class="search1" style="margin:20px auto; text-align: center;">
                                            <form method="post" action="do_search.php">
                                                <input type="text" style="width: 80%;" name="search" id="search_box" class='search_box'/>
                                                <input type="submit" value="Search" class="search_button" /><br />
                                            </form>
                                        </div>

                                        <div>
                                        <div id="searchresults" class="content table-responsive table-full-width">Search results :</div>
                                            <ul id="results" class="update">
                                            </ul>
                                        </div>

                                        <form method="POST" action="change.php">
                                            <input type="hidden" id="mail" name="mail" value="mario@gmail.com" />
                                            <select id="change_box" name="change" class="change_box">
                                                                <option value="1">Make Credible</option>
                                                                <option value="0">Make Uncredible</option>
                                                            </select><br/><br/>
                                            <input type="button" value="Change" id="change_button" />
                                        </form>

                                    </div>
                                </div>
                            </div>  
                        </div>     
                    </div>
                </div>
            </div>
        </div>


        <footer class="footer">
            <div class="container-fluid">
                <nav class="pull-left">
                    <ul>
                        <li>
                            <a href="#">
                                Home
                            </a>
                        </li>
                    </ul>
                </nav>
                <p class="copyright pull-right">
                    &copy; 2017 <a href="#">GroupTech</a>
                </p>
            </div>
        </footer>

    </div>
</div>

 <!--   Core JS Files   -->
    <script src="assets/js/jquery-1.10.2.js" type="text/javascript"></script>
    <script src="assets/js/bootstrap.min.js" type="text/javascript"></script>

    <!--  Checkbox, Radio & Switch Plugins -->
    <script src="assets/js/bootstrap-checkbox-radio-switch.js"></script>

    <!--  Charts Plugin -->
    <script src="assets/js/chartist.min.js"></script>

    <!--  Notifications Plugin    -->
    <script src="assets/js/bootstrap-notify.js"></script>

    <!--  Google Maps Plugin    -->
    <script type="text/javascript" src="https://maps.googleapis.com/maps/api/js?sensor=false"></script>

    <!-- Light Bootstrap Table Core javascript and methods for Demo purpose -->
    <script src="assets/js/light-bootstrap-dashboard.js"></script>

    <!-- Light Bootstrap Table DEMO methods, don't include it in your project! -->
    <script src="assets/js/demo.js"></script>


    <script type="text/javascript" src="assets/js/jquery.min.js"></script>
    <script type="text/javascript" src="assets/js/Chart.min.js"></script>
    <script type="text/javascript" src="assets/js/pie.js"></script>
    <script type="text/javascript" src="assets/js/linegraph.js"></script>
    <!-- <script type="text/javascript" src="assets/js/upload.js"></script> -->

    <script type="text/javascript">
        $(function() {
 
            $(".search_button").click(function() {
                // getting the value that user typed
                var searchString    = $("#search_box").val();
                // forming the queryString
                var data            = 'search='+ searchString;
                 
                // if searchString is not empty
                if(searchString) {
                    // ajax call
                    $.ajax({
                        type: "POST",
                        url: "search.php",
                        data: data,
                        beforeSend: function(html) { // this happens before actual call
                            $("#results").html(''); 
                            $("#searchresults").show();
                            $(".word").html(searchString);
                       },
                       success: function(html){ // this happens after we get results
                            $("#results").show();
                            $("#results").append(html);
                      }
                    });    
                }
                return false;
            });
        });
    </script>

    <script type="text/javascript">
        // $(function() {
 
        //     $(".change_button").submit(function() {
        //         // getting the value that user typed
        //         var changeString    = $("#change_box").val();
        //         var mail = $("#mail").val();
        //         // forming the queryString
        //         var data            ="?change=" + changeString + "&mail=" + mail; 
        //         //intercept default submit
        //         $(".change_button").preventDefault();
        //         var $form = $(this);
        //         // if searchString is not empty
        //             // ajax call
        //             $.ajax({
        //                 type: "POST",
        //                 cache: false,
        //                 url: $form.attr('action'),
        //                 data: data,
        //                 beforeSend: function(html) { // this happens before actual call
        //                     $("#changes").html(''); 
        //                     $("#changeresults").show();
        //                     $(".word").html(changeString);
        //                },
        //                success: function(html){ // this happens after we get results
        //                     $("#changes").show();
        //                     $("#changes").append(html);
        //               }
        //             });   
        //         return false;
        //     });
        // });


    $(document).ready(function() {
   // Bind submit button onclick handler to send an Ajax request and
   //  process Ajax response.
   $('#change_button').click(function (event) {

      event.preventDefault();  // Do not run the default action

      // getting the value that user typed
        var changeString    = $("#change_box").val();
        var mail = $("#mail").val();
        // forming the queryString
        // var data            ="?change=" + changeString + "&mail=" + mail; 

      $.ajax({
         type: 'POST',
         url:  'change.php',
         data: {"change":changeString, "mail":mail},
      })
         .done( function (responseText) {
            // Triggered if response status code is 200 (OK)
            $('#changes').html(responseText);
         })
         .fail( function (jqXHR, status, error) {
            // Triggered if response status code is NOT 200 (OK)
            alert(jqXHR.responseText);
         })
         .always( function() {
            // Always run after .done() or .fail()
         });
   });
});
    </script>

<script type="text/javascript" src="assets/js/crps.js"></script>
<script type="text/javascript">
  //function to train nueral net
/* use_to_train_network(activation_function,network_type,array_to_train_input_output,iterationsx,errorx,costx,ratex,first_level,second_level,third_level,fourth_level);
*/

     var minoz =[];
     var ratey = 0.05;
     var iterationsy = 10000;
     var errory = .03;
     var first_level = 20;
     var second_level = 10;
     var third_level = 10;
     var network_type = "LSTM";
     var fourth_level = 10;
     var urlz = "http://localhost/CRPS/dashchart/server.php";
     var urly = "http://localhost/CRPS/dashchart/server2.php";
     var newNetwork;
     var predicitonx;

/**************START OF FILE FUNCTON*************/
       function handleFiles(files) {
      // Check for the various File API support.
      if (window.FileReader) {
          // FileReader are supported.
          getAsText(files[0]);
      } else {
          alert('FileReader are not supported in this browser.');
      }
    }

    function getAsText(fileToRead) {
      var reader = new FileReader();
      // Read file into memory as UTF-8      
      reader.readAsText(fileToRead);
      // Handle errors load
      reader.onload = loadHandler;
      reader.onerror = errorHandler;
    }

    function loadHandler(event) {
      var csv = event.target.result;
      processData(csv);
    }

     function processData(csv) {
             var lines = [];
             var minoz =[];
             var boxs = [];
        var allTextLines = csv.split(/\r\n|\n/);
        for (var i=0; i<allTextLines.length; i++) {
            var data = allTextLines[i].split(';');
                var tarr = [];
                for (var j=0; j<data.length; j++) {
                    tarr.push(data[j]);
                }
                lines.push(tarr);
                //tarr.shift();
                boxs.push(tarr);
        }
var inputx = [];
//create train Data Set
for (var i = 0; i <lines.length ; i++) {

            inputx.push(lines[i][0]);
              }
//console.log(inputx[0]);
var hold =[];
for (var i = 0; i <inputx.length; i++) {
  hold.push(inputx[0].slice(2));

}
//var array = string.split(',');
//console.log(hold[0]);
var holder =[];
for (var i = 0; i < hold.length ; i++) {
  holder.push(hold[i].split(','));
}
  /*            
 console.log({ input: holder[0], output: [1] },{ input: [0003,0.0036,0.0003,0.0004,0.798,0.0004,0.0001,0.0004,0.0002,0.0001,0.0004,0.0003,0.0027,0.0002,0.0001,0.0002,0.0001,0.0001,0.0002], output: [1] });
              //hold.push(inputx[0].slice(2));
*/
for (var i = 0; i <10 ; i++) {

minoz.push({ input: holder[i], output: [lines[i][0][0]] });
/********Array to be used ******************/
console.log("Done");
}
}
function errorHandler(evt) {
      if(evt.target.error.name == "NotReadableError") {
          alert("Canno't read file !");
      }
    }

/**************END OF FILE FUNCTON*************/


$("#tnn").click(function() {
  //function to train nueral net
  newNetwork = use_to_train_network(synaptic.Neuron.LOGISTIC,network_type,minoz,iterationsy,errory,ratey,first_level,second_level,third_level,fourth_level);
  console.log("Done=>tnn");
});

$("#tnnx").click(function() {
  var secondlevelz = document.getElementById('sl').value;
  var thirdlevelz =document.getElementById('tl').value;
  var fourthlevelz =document.getElementById('fl').value;
  var ratez = document.getElementById('rate').value;
  var errorz = document.getElementById('errorz').value;
  var iterationz = document.getElementById('iterations').value;
  var networkzact = document.getElementById('networkxact').value;
   var networktype = document.getElementById('networktype').value;
  //function to train nueral net
  newNetwork = use_to_train_network(networkzact,networktype,minoz,iterationz,errorz,ratez,first_level,secondlevelz,thirdlevelz,fourthlevelz);
  console.log("Done=>tnnx");
});

$("#snn").click(function() {
//function to store nueral net
use_to_store_nueral_net(urlz,newNetwork);
console.log("Done=>snn");
});

$("#unns").click(function() {
//function to use stored nueral net
var datax = [0.0002,0.0094,0.0003,0.0002,0.2028,0.0001,0.0005,0.0002,0.0002,0.0001,0.0002,0.0002,0.003,0.0002,0.0002,0.0001,0.0001,0.0001,0.0001,0.0001];
 //var predicitonz = use_stored_nueral_net(urly,datax);

    var neededData; 
    var prediction; 
    var data_returned;
    var myRestoredNet;

var jqxhr = $.getJSON( urly, function(data) {
  neededData = JSON.parse(data);

   myRestoredNet = synaptic.Network.fromJSON(neededData[0]);

 prediction = myRestoredNet.activate(datax)
  console.log( "success" );

})
  .done(function(data) {
    console.log(prediction);

   fn = parseFloat(prediction, 10);
   test = fn.toFixed(3);
   document.getElementById("answer").innerHTML = test;

  })
  .fail(function() {
    console.log( "error" );
  })
  .always(function() {

   $.ajax({
         type: 'GET',
         url:  'train.php',
         data: {"test":test},
         //context: document.body,
         global: false,
         async:false,
         success: function(data) {
            return data;
            console.log(data);
        }
      }).responseText;
  });

//return prediction;
console.log("Done=>unns");

});


$("#unnws").click(function() {
//function to use nueral net without storing
var datax = [0.0003,0.0024,0.0003,0.0002,0.2028,0.0001,0.0003,0.0002,0.0002,0.0001,0.0002,0.0002,0.003,0.0002,0.0002,0.0002,0.0001,0.0001,0.0001,0.0001];
var predicitony = use_nueral_net_before_storing(newNetwork,datax);

console.log(predicitony);
    fn2 = parseFloat(predictiony, 10);
   document.getElementById("answer2").innerHTML = fn2;

console.log("Done=>unnws");

});

</script>

</body>


</html>
